<?xml version="1.0"?>
<project name="unpack-kotlin-wrapper" default="unpack">
<!--
required props:
 ${wrapper.jar}
 ${wrappers.path}
 ${npm.path}
-->
    <target name="unpack" depends="unpack-if-not-unpacked, message-if-already-unpacked"/>


    <target name="unpack-if-not-unpacked" depends="set-props" unless="unpacked">
            <echo message="extract name=${wrapper.name}, ver=${wrapper.ver}"/>

            <unzip src="${wrapper.jar}" dest="${wrapper.dest-path}">
                <patternset>
                    <include name="*.js"/>
                    <include name="*.js.map"/>
                    <exclude name="*.meta.js"/>
                </patternset>
            </unzip>
            <echo file="${wrapper.dest-path}/package.json" append="false"><![CDATA[
{
  "main": "${wrapper.name}.js",
  "devDependencies": {},
  "dependencies": {},
  "peerDependencies": {},
  "optionalDependencies": {},
  "bundledDependencies": [],
  "name": "${wrapper.name}",
  "version": "${wrapper.ver}"
}
]]>
            </echo>
    </target>


    <target name="message-if-already-unpacked" depends="set-props" if="unpacked">
        <echo message="already unpacked: name=${wrapper.name}, ver=${wrapper.ver}"/>
    </target>


    <target name="set-props">
        <dirname property="wrapper.ver-path" file="${wrapper.jar}"/>
        <dirname property="wrapper.name-path" file="${wrapper.ver-path}"/>

        <basename property="wrapper.ver" file="${wrapper.ver-path}"/>
        <basename property="wrapper.name" file="${wrapper.name-path}"/>

        <property name="wrapper.dest-path" value="${wrappers.path}/${wrapper.name}"/>

        <available file="${wrapper.dest-path}/package.json" property="unpacked"/>
    </target>
</project>